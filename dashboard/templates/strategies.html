<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Strategies - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            background-color: #fff;
        }

        /* Sidebar */
        .sidebar {
    width: 250px;
    background-color: #f8f9fa;
    color: #333;
    padding: 20px;
    position: fixed;
    height: 100%;
    overflow-y: auto;
}

.sidebar h2 {
    font-size: 1.5rem;
    color: #333;
    margin-bottom: 30px;
    font-family: 'Roboto', sans-serif;
}

.sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar-link {
    display: block;
    color: #000;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
    font-size: 1rem;
    font-family: 'Roboto', sans-serif;
    margin-bottom: 4px;
    transition: background-color 0.2s ease;
}

.sidebar-link:hover {
    background-color: #f0f0f0;
}

.sidebar-sub-link {
    display: block;
    color: #000;
    padding: 8px 25px;
    text-decoration: none;
    font-size: 0.9rem;
    font-family: 'Roboto', sans-serif;
    margin-bottom: 2px;
    transition: background-color 0.2s ease;
}

.sidebar-sub-link:hover {
    background-color: #f0f0f0;
}

.sidebar-link.collapsible .arrow {
    float: right;
    transition: transform 0.2s ease;
}

.sidebar-link.collapsible[aria-expanded="true"] .arrow {
    transform: rotate(180deg);
}

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
            width: calc(100% - 250px);
        }

        h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        h3 {
            font-size: 18px;
            color: #333;
            margin: 20px 0 10px;
        }

        h4 {
            font-size: 16px;
            color: #555;
            margin: 10px 0;
        }

        /* Form */
        form {
            margin-bottom: 30px;
        }

        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
            font-size: 14px;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #333;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* Tutorial Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            margin: 10% auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            position: relative;
        }

        .modal-content h3 {
            margin-bottom: 15px;
        }

        .tutorial-step {
            margin: 10px 0;
            line-height: 1.5;
            display: none;
        }

        .tutorial-step.active {
            display: block;
        }

        .modal-content .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }

        .modal-content .modal-buttons button {
            padding: 8px 15px;
        }

        /* Industry Buttons */
        .industry-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .industry-btn {
            padding: 10px 15px;
            background-color: #e9ecef;
            color: #333;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .industry-btn:hover {
            background-color: #000;
            color: #fff;
            transform: scale(1.05);
        }

        .industry-btn.active {
            background-color: #000;
            color: #fff;
        }

        /* Industry Prompts */
        .industry-prompts {
            display: none;
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .industry-prompts p {
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #000;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .industry-prompts p:hover {
            background-color: #f0f7ff;
        }
        /* Strategy Container */
#strategies-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
}

        /* Strategy Cards */
.strategy-card {
    background-color: #fff;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 15px;
    position: relative;
    flex: 1 1 calc(33.333% - 20px); /* 3 cards per row with gap */
    min-width: 300px;
    box-sizing: border-box;
}

        .strategy-card.active {
            border: 2px solid #ffd700;
            box-shadow: 0 0 10px #ffd700;
        }

        .strategy-card.active::after {
            content: 'Active';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffd700;
            padding: 2px 8px;
            font-size: 12px;
            border-radius: 3px;
            color: #333;
        }

        .strategy-card h4 {
            margin-bottom: 10px;
        }

        .strategy-card p {
            margin: 5px 0;
        }

        .details {
            display: none;
            margin-top: 10px;
        }

        .strategy-card button {
            margin: 5px 5px 0 0;
            padding: 5px 10px;
            font-size: 14px;
        }

        /* Error Messages */
        .error {
            color: #ff5e5e;
            margin-bottom: 15px;
        }

        /* Messages */
        .messages {
            margin-bottom: 15px;
        }

        .messages div {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }

        .messages .success {
            background-color: #d4edda;
            color: #155724;
        }

        .messages .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        :root {
    --color-black: #1c1c1c;
    --color-white: #fff;
    --color-black-rgb: 28, 28, 28;
}

.navbar {
    background-color: var(--color-black);
    padding: 12px;
    box-shadow: 0 2px 5px rgba(var(--color-black-rgb), 0.1);
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.navbar h1 {
    font-size: 2rem;
    color: var(--color-white);
    margin: 0;
    font-family: 'Inter', sans-serif;
}
.user-info p {
    font-size: 16px;
    color: #fff;
}

    </style>
</head>
<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Logo</h2>
        <ul>
            <li><a href="{% url 'dashboard' %}" class="sidebar-link">Home</a></li>

            <li>
                <a class="sidebar-link collapsible" data-bs-toggle="collapse" href="#customerMenu" role="button" aria-expanded="false" aria-controls="customerMenu">
                    Customers <i class="bi bi-chevron-down arrow"></i>
                </a>
                <div class="collapse" id="customerMenu" data-bs-parent=".sidebar">
                    <a href="{% url 'customer_insights' %}" class="sidebar-sub-link">Customer Insights</a>
                    <a href="{% url 'rfm_analysis' %}" class="sidebar-sub-link">RFM Analysis</a>
                    <a href="{% url 'rfm_churn_visualizations' %}" class="sidebar-sub-link">RFM & Churn Trends</a>
                    <a href="{% url 'customer_profile' %}" class="sidebar-sub-link active">Customer Profiles</a>
                </div>
            </li>

            <li>
                <a class="sidebar-link collapsible" data-bs-toggle="collapse" href="#trendsMenu" role="button" aria-expanded="false" aria-controls="trendsMenu">
                    Trends <i class="bi bi-chevron-down arrow"></i>
                </a>
                <div class="collapse" id="trendsMenu" data-bs-parent=".sidebar">
                    <a href="{% url 'eda_charts' %}" class="sidebar-sub-link">Data Exploration</a>
                    <a href="{% url 'cohort_analysis' %}" class="sidebar-sub-link">Cohort Analysis</a>
                </div>
            </li>

            <li>
                <a class="sidebar-link collapsible" data-bs-toggle="collapse" href="#marketingMenu" role="button" aria-expanded="false" aria-controls="marketingMenu">
                    Marketing <i class="bi bi-chevron-down arrow"></i>
                </a>
                <div class="collapse" id="marketingMenu" data-bs-parent=".sidebar">
                    <a href="{% url 'strategies' %}" class="sidebar-sub-link">Ad Strategies</a>
                </div>
            </li>

            <li><a href="{% url 'financial_insights' %}" class="sidebar-link">Finance</a></li>
            <li><a href="{% url 'product_insights' %}" class="sidebar-link">Products</a></li>
            <li><a href="{% url 'signout' %}" class="sidebar-link">Sign Out</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- <div style="margin-bottom: 20px;">
            <h1 style="font-size: 2rem; font-weight: bolder; color: #000;">Ad Strategy Builder</h1>
        </div> -->
        <div class="navbar">
            <h1>Ad Strategy Builder</h1>
            <div class="user-info">
                {% if user.is_authenticated %}
                    <p>Hello, {{ user.username }}!</p>
                {% else %}
                    <a href="{% url 'signin' %}">Sign In</a>
                    <a href="{% url 'signup' %}">Sign Up</a>
                {% endif %}
            </div>
        </div>
        
        <div class="messages">
            {% if messages %}
                {% for message in messages %}
                    <div class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        </div>

        {% if error %}
            <div class="error">{{ error }}</div>
        {% endif %}

        <h2>Write your prompt to generate ad strategies</h2>
        {% if request.user.userprofile.strategy_count >= 2 and not request.user.userprofile.is_premium %}
    <div class="error" style="color: red; font-weight: bold; margin-bottom: 1rem;">
        🚫 You’ve reached your free strategy generation limit. Please upgrade to premium.
    </div>
    <a href="{% url 'upgrade_premium' %}" class="btn btn-warning" style=" margin-bottom: .5rem;" >
        Upgrade to Premium
    </a>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('prompt-textarea').disabled = true;
            document.querySelector('#strategy-form button[type="submit"]').disabled = true;
        });
    </script>
{% endif %}
        <form id="strategy-form" method="POST" action="{% url 'generate_multiple_strategies' %}">
            {% csrf_token %}
            <textarea name="prompt" id="prompt-textarea" placeholder="Type your strategy prompt here..."></textarea>
            <button type="submit">Submit</button>
        </form>

        <button onclick="openTutorialModal()">Start Tutorial</button>

        <div id="tutorial-modal" class="modal">
            <div class="modal-content">
                <h3>Tutorial</h3>
                <div id="tutorial-steps">
                    <div class="tutorial-step">
                        <strong>Step 1: Enter Your Prompt</strong><br>
                        Start by typing your ad strategy prompt in the textarea labeled "Write your prompt to generate ad strategies." Be specific about your goals, budget, and audience.<br>
                        📝 [Textarea: "Type your strategy prompt here..."]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 2: Select an Industry Prompt (Optional)</strong><br>
                        Click an industry prompt box (e.g., "Skincare" or "Fashion") to auto-fill the textarea with a pre-built prompt, which you can then customize.<br>
                        🖱️ [Button: "Skincare"]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 3: Review the Prompt</strong><br>
                        Check the auto-filled prompt in the textarea and edit it to fit your needs before submitting.<br>
                        📝 [Textarea: "Promote a skincare product..."]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 4: Submit Your Prompt</strong><br>
                        Click the "Submit" button to generate ad strategies based on your prompt.<br>
                        ✅ [Button: "Submit"]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 5: Explore Generated Strategies</strong><br>
                        Once generated, your strategies will appear as cards below, showing key details like Goal and Budget.<br>
                        📋 [Strategy Card: Goal: Increase Sales, Budget: ₹5000]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 6: Show More Details</strong><br>
                        Click "Show Details" on a strategy card to expand it and view additional information like Audience and Platform.<br>
                        🔍 [Button: "Show Details"]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 7: Edit a Strategy</strong><br>
                        Click "Edit" on a strategy card to open a modal where you can modify its details.<br>
                        ✏️ [Button: "Edit"]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 8: Select a Strategy</strong><br>
                        Click "Select" on a strategy card to choose it and proceed with your ad setup.<br>
                        ✔️ [Button: "Select"]
                    </div>
                    <div class="tutorial-step">
                        <strong>Step 9: See the Active Strategy</strong><br>
                        The selected strategy will be highlighted with a glowing border and an "Active" badge to indicate your choice.<br>
                        🌟 [Strategy Card: Highlighted with "Active" Badge]
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="prev-btn" onclick="navigateTutorial(-1)">Previous</button>
                    <button id="next-btn" onclick="navigateTutorial(1)">Next</button>
                    <button onclick="document.getElementById('tutorial-modal').style.display='none'">Close</button>
                </div>
            </div>
        </div>

        <h3>Example Prompts by Industry (Click an industry to view prompts)</h3>
        <div class="industry-buttons">
            <button class="industry-btn" data-industry="Skincare">Skincare</button>
            <button class="industry-btn" data-industry="Fashion">Fashion</button>
            <button class="industry-btn" data-industry="Tech">Tech</button>
            <button class="industry-btn" data-industry="Fitness">Fitness</button>
            <button class="industry-btn" data-industry="Food & Beverage">Food & Beverage</button>
            <button class="industry-btn" data-industry="Travel">Travel</button>
        </div>

        <!-- Industry Prompts -->
        <!-- Skincare -->
        <div class="industry-prompts" data-industry="Skincare">
            <p data-prompt="Create a Meta Ads strategy for a sustainable skincare brand targeting women aged 25-40 in the US. The goal is to drive conversions with a $1000 monthly budget. Highlight natural ingredients and use carousel + video ads">Create a Meta Ads strategy for a sustainable skincare brand targeting women aged 25-40 in the US. The goal is to drive conversions with a $1000 monthly budget. Highlight natural ingredients and use carousel + video ads</p>
            <p data-prompt="Develop a Google Ads campaign for a luxury skincare line targeting high-income women aged 30-50 globally. Focus on brand awareness with a $5000 budget, using YouTube video ads">Develop a Google Ads campaign for a luxury skincare line targeting high-income women aged 30-50 globally. Focus on brand awareness with a $5000 budget, using YouTube video ads</p>
            <p data-prompt="Design a Meta Ads campaign for a vegan skincare brand targeting eco-conscious consumers aged 20-35 in Europe. Aim for engagement with a $1500 budget, using Instagram Stories">Design a Meta Ads campaign for a vegan skincare brand targeting eco-conscious consumers aged 20-35 in Europe. Aim for engagement with a $1500 budget, using Instagram Stories</p>
            <p data-prompt="Create a Google Ads strategy for a dermatologist-recommended skincare brand targeting adults aged 25-45 in the US. Drive sales with a $3000 budget, using Search Ads">Create a Google Ads strategy for a dermatologist-recommended skincare brand targeting adults aged 25-45 in the US. Drive sales with a $3000 budget, using Search Ads</p>
        </div>

        <!-- Fashion -->
        <div class="industry-prompts" data-industry="Fashion">
            <p data-prompt="Create a Meta Ads strategy for a sustainable fashion brand targeting women aged 18-35 in the UK. The goal is to increase sales with a $2000 budget, using Instagram Reels and Stories">Create a Meta Ads strategy for a sustainable fashion brand targeting women aged 18-35 in the UK. The goal is to increase sales with a $2000 budget, using Instagram Reels and Stories</p>
            <p data-prompt="Develop a Google Ads campaign for a luxury fashion brand targeting affluent men aged 30-50 globally. Focus on brand awareness with a $7000 budget, using Display Ads">Develop a Google Ads campaign for a luxury fashion brand targeting affluent men aged 30-50 globally. Focus on brand awareness with a $7000 budget, using Display Ads</p>
            <p data-prompt="Design a Meta Ads campaign for a streetwear brand targeting Gen Z aged 16-24 in the US. Aim for engagement with a $1200 budget, using Instagram Feed posts">Design a Meta Ads campaign for a streetwear brand targeting Gen Z aged 16-24 in the US. Aim for engagement with a $1200 budget, using Instagram Feed posts</p>
            <p data-prompt="Create a Google Ads strategy for an ethical fashion brand targeting eco-conscious consumers aged 25-40 in Australia. Drive sales with a $2500 budget, using Search Ads">Create a Google Ads strategy for an ethical fashion brand targeting eco-conscious consumers aged 25-40 in Australia. Drive sales with a $2500 budget, using Search Ads</p>
        </div>

        <!-- Tech -->
        <div class="industry-prompts" data-industry="Tech">
            <p data-prompt="Create a Meta Ads strategy for a tech startup launching a new app targeting professionals aged 25-45 in the US. The goal is to drive app installs with a $3000 budget, using video ads on Facebook">Create a Meta Ads strategy for a tech startup launching a new app targeting professionals aged 25-45 in the US. The goal is to drive app installs with a $3000 budget, using video ads on Facebook</p>
            <p data-prompt="Develop a Google Ads campaign for a smart home device brand targeting homeowners aged 30-55 globally. Focus on conversions with a $5000 budget, using Search Ads">Develop a Google Ads campaign for a smart home device brand targeting homeowners aged 30-55 globally. Focus on conversions with a $5000 budget, using Search Ads</p>
            <p data-prompt="Design a Meta Ads campaign for a gaming tech brand targeting gamers aged 18-35 in Europe. Aim for engagement with a $2000 budget, using Instagram Reels">Design a Meta Ads campaign for a gaming tech brand targeting gamers aged 18-35 in Europe. Aim for engagement with a $2000 budget, using Instagram Reels</p>
            <p data-prompt="Create a Google Ads strategy for a cybersecurity software targeting businesses in the US. Drive leads with a $4000 budget, using Search and Display Ads">Create a Google Ads strategy for a cybersecurity software targeting businesses in the US. Drive leads with a $4000 budget, using Search and Display Ads</p>
        </div>

        <!-- Fitness -->
        <div class="industry-prompts" data-industry="Fitness">
            <p data-prompt="Create a Meta Ads strategy for a fitness app targeting health enthusiasts aged 20-40 in the US. The goal is to drive app installs with a $1500 budget, using Instagram Stories">Create a Meta Ads strategy for a fitness app targeting health enthusiasts aged 20-40 in the US. The goal is to drive app installs with a $1500 budget, using Instagram Stories</p>
            <p data-prompt="Develop a Google Ads campaign for a gym equipment brand targeting fitness buffs aged 25-45 globally. Focus on sales with a $3000 budget, using Search Ads">Develop a Google Ads campaign for a gym equipment brand targeting fitness buffs aged 25-45 globally. Focus on sales with a $3000 budget, using Search Ads</p>
            <p data-prompt="Design a Meta Ads campaign for a yoga studio targeting women aged 30-50 in Canada. Aim for engagement with a $1000 budget, using Facebook video ads">Design a Meta Ads campaign for a yoga studio targeting women aged 30-50 in Canada. Aim for engagement with a $1000 budget, using Facebook video ads</p>
            <p data-prompt="Create a Google Ads strategy for a fitness supplement brand targeting athletes aged 20-35 in the UK. Drive sales with a $2500 budget, using Search Ads">Create a Google Ads strategy for a fitness supplement brand targeting athletes aged 20-35 in the UK. Drive sales with a $2500 budget, using Search Ads</p>
        </div>

        <!-- Food & Beverage -->
        <div class="industry-prompts" data-industry="Food & Beverage">
            <p data-prompt="Create a Meta Ads strategy for a vegan snack brand targeting health-conscious consumers aged 25-45 in the US. The goal is to drive sales with a $2000 budget, using Instagram Feed ads">Create a Meta Ads strategy for a vegan snack brand targeting health-conscious consumers aged 25-45 in the US. The goal is to drive sales with a $2000 budget, using Instagram Feed ads</p>
            <p data-prompt="Develop a Google Ads campaign for a gourmet coffee brand targeting coffee lovers aged 30-50 globally. Focus on brand awareness with a $4000 budget, using YouTube video ads">Develop a Google Ads campaign for a gourmet coffee brand targeting coffee lovers aged 30-50 globally. Focus on brand awareness with a $4000 budget, using YouTube video ads</p>
            <p data-prompt="Design a Meta Ads campaign for a meal delivery service targeting busy professionals aged 25-40 in the UK. Aim for conversions with a $2500 budget, using Facebook carousel ads">Design a Meta Ads campaign for a meal delivery service targeting busy professionals aged 25-40 in the UK. Aim for conversions with a $2500 budget, using Facebook carousel ads</p>
            <p data-prompt="Create a Google Ads strategy for an organic juice brand targeting health enthusiasts aged 20-35 in Australia. Drive sales with a $1500 budget, using Search Ads">Create a Google Ads strategy for an organic juice brand targeting health enthusiasts aged 20-35 in Australia. Drive sales with a $1500 budget, using Search Ads</p>
        </div>

        <!-- Travel -->
        <div class="industry-prompts" data-industry="Travel">
            <p data-prompt="Create a Meta Ads strategy for a travel agency targeting adventure seekers aged 25-45 in the US. The goal is to drive bookings with a $3000 budget, using Instagram Reels">Create a Meta Ads strategy for a travel agency targeting adventure seekers aged 25-45 in the US. The goal is to drive bookings with a $3000 budget, using Instagram Reels</p>
            <p data-prompt="Develop a Google Ads campaign for a luxury travel brand targeting high-income travelers aged 35-60 globally. Focus on brand awareness with a $6000 budget, using Display Ads">Develop a Google Ads campaign for a luxury travel brand targeting high-income travelers aged 35-60 globally. Focus on brand awareness with a $6000 budget, using Display Ads</p>
            <p data-prompt="Design a Meta Ads campaign for a budget travel app targeting students aged 18-25 in Europe. Aim for app installs with a $1000 budget, using Facebook video ads">Design a Meta Ads campaign for a budget travel app targeting students aged 18-25 in Europe. Aim for app installs with a $1000 budget, using Facebook video ads</p>
            <p data-prompt="Create a Google Ads strategy for a travel gear brand targeting outdoor enthusiasts aged 25-50 in Canada. Drive sales with a $2000 budget, using Search Ads">Create a Google Ads strategy for a travel gear brand targeting outdoor enthusiasts aged 25-50 in Canada. Drive sales with a $2000 budget, using Search Ads</p>
        </div>

        {% if google_strategies or meta_strategies %}
        <h3>Recent Ad Strategies</h3>
        {% if google_strategies %}
        <div>
            <h4>Google Ad Strategies</h4>
            {% for strategy in google_strategies %}
                <p>{{ strategy.goal }} - {{ strategy.ad_type }} ({{ strategy.created_at|date:"d M Y" }})</p>
            {% empty %}
                <p>No Google strategies submitted yet.</p>
            {% endfor %}
        </div>
        {% endif %}
        {% if meta_strategies %}
        <div>
            <h4>Meta Ad Strategies</h4>
            {% for strategy in meta_strategies %}
                <p>{{ strategy.goal }} - {{ strategy.ad_type }} ({{ strategy.created_at|date:"d M Y" }})</p>
            {% empty %}
                <p>No Meta strategies submitted yet.</p>
            {% endfor %}
        </div>
        {% endif %}
        {% endif %}

        <div id="strategies-container"></div>

        <div id="edit-strategy-modal" class="modal">
            <div class="modal-content">
                <h3>Edit Strategy</h3>
                <form id="edit-strategy-form" method="POST" action="{% url 'save_edited_strategy' %}">
                    {% csrf_token %}
                    <input type="hidden" name="strategy_id" id="strategy-id">
                    <textarea name="content" id="strategy-content"></textarea>
                    <button type="submit">Save</button>
                    <button type="button" onclick="document.getElementById('edit-strategy-modal').style.display='none'">Cancel</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script>
        // Tutorial Modal Navigation
        let currentStep = 0;
        const stepsPerPage = 3;
        const tutorialSteps = document.querySelectorAll('#tutorial-steps .tutorial-step');
        const totalSteps = tutorialSteps.length;
        
        function updateTutorialDisplay() {
            tutorialSteps.forEach((step, index) => {
                step.classList.toggle('active', index >= currentStep && index < currentStep + stepsPerPage);
            });
            document.getElementById('prev-btn').disabled = currentStep === 0;
            document.getElementById('next-btn').disabled = currentStep + stepsPerPage >= totalSteps;
        }
        
        function openTutorialModal() {
            currentStep = 0;
            updateTutorialDisplay();
            document.getElementById('tutorial-modal').style.display = 'block';
        }
        
        function navigateTutorial(direction) {
            currentStep += direction * stepsPerPage;
            if (currentStep < 0) currentStep = 0;
            if (currentStep > totalSteps - stepsPerPage) currentStep = totalSteps - stepsPerPage;
            if (currentStep < 0) currentStep = 0; // Ensure it doesn't go negative
            updateTutorialDisplay();
        }
        
        // Handle industry prompt buttons
        document.querySelectorAll('.industry-btn').forEach(button => {
            button.addEventListener('click', () => {
                const industry = button.getAttribute('data-industry');
                document.querySelectorAll('.industry-prompts').forEach(promptDiv => {
                    promptDiv.style.display = promptDiv.getAttribute('data-industry') === industry ? 'block' : 'none';
                });
                document.querySelectorAll('.industry-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            });
        });
        
        // Handle prompt selection
        document.querySelectorAll('.industry-prompts p').forEach(prompt => {
            prompt.addEventListener('click', () => {
                document.getElementById('prompt-textarea').value = prompt.getAttribute('data-prompt');
            });
        });
        
        // Handle strategy form submission
        document.getElementById('strategy-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayStrategies(data.strategies);
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while generating strategies.');
            });
        });
        
        // Display generated strategies
        function displayStrategies(strategies) {
            const container = document.getElementById('strategies-container');
            container.innerHTML = '';
            strategies.forEach(strategy => {
                const card = document.createElement('div');
                card.className = 'strategy-card';
                card.setAttribute('data-id', strategy.id);
        
                const title = document.createElement('h3');
                title.textContent = strategy.title;
                card.appendChild(title);
        
                // Show key details (e.g., Goal and Budget)
                const summary = strategy.content
                    .filter(item => ['Goal', 'Budget'].includes(item.key))
                    .map(item => `<p><strong>${item.key}:</strong> ${item.value}</p>`)
                    .join('');
                card.innerHTML += summary;
        
                // Details section (hidden by default)
                const details = document.createElement('div');
                details.className = 'details';
                details.style.display = 'none';
                const otherDetails = strategy.content
                    .filter(item => !['Goal', 'Budget'].includes(item.key))
                    .map(item => `<p><strong>${item.key || ''}:</strong> ${item.value}</p>`)
                    .join('');
                details.innerHTML = otherDetails;
                card.appendChild(details);
        
                // Show Details button
                const showDetailsBtn = document.createElement('button');
                showDetailsBtn.textContent = 'Show Details';
                showDetailsBtn.addEventListener('click', () => {
                    details.style.display = details.style.display === 'none' ? 'block' : 'none';
                    showDetailsBtn.textContent = details.style.display === 'none' ? 'Show Details' : 'Hide Details';
                });
                card.appendChild(showDetailsBtn);
        
                // Edit button
                const editBtn = document.createElement('button');
                editBtn.textContent = 'Edit';
                editBtn.addEventListener('click', () => {
                    document.getElementById('strategy-id').value = strategy.id;
                    document.getElementById('strategy-content').value = strategy.content
                        .map(item => `${item.key ? item.key + ': ' : ''}${item.value}`)
                        .join('\n');
                    document.getElementById('edit-strategy-modal').style.display = 'block';
                });
                card.appendChild(editBtn);
        
                // Select button
                const selectBtn = document.createElement('button');
                selectBtn.className = 'select-strategy';
                selectBtn.textContent = 'Select';
                selectBtn.setAttribute('data-id', strategy.id);
                card.appendChild(selectBtn);
        
                container.appendChild(card);
            });
        }
        
        // Handle edit form submission
        document.getElementById('edit-strategy-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('edit-strategy-modal').style.display = 'none';
                    // Refresh strategies
                    fetch('{% url "generate_multiple_strategies" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': getCookie('csrftoken')
                        },
                        body: `prompt=${encodeURIComponent(document.getElementById('prompt-textarea').value)}`
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            displayStrategies(data.strategies);
                        }
                    });
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while saving the strategy.');
            });
        });
        
        // Utility function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // DOM Content Loaded Event Listener
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('strategy-form');
            const promptTextarea = document.getElementById('strategy-prompt');
            const strategiesContainer = document.getElementById('strategies-container');
            const industryPrompts = document.querySelectorAll('.industry-prompt');
            const tutorialBtn = document.getElementById('tutorial-btn');
            const tutorialModal = document.getElementById('tutorial-modal');
            const closeTutorial = document.getElementById('close-tutorial');
            const prevStep = document.getElementById('prev-step');
            const nextStep = document.getElementById('next-step');
            const tutorialSteps = document.querySelectorAll('.tutorial-step');
            let currentStep = 0;
        
            // Tutorial Modal
            tutorialBtn.addEventListener('click', () => {
                tutorialModal.style.display = 'block';
                showStep(currentStep);
            });
        
            closeTutorial.addEventListener('click', () => {
                tutorialModal.style.display = 'none';
                currentStep = 0;
                showStep(currentStep);
            });
        
            prevStep.addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    showStep(currentStep);
                }
            });
        
            nextStep.addEventListener('click', () => {
                if (currentStep < tutorialSteps.length - 1) {
                    currentStep++;
                    showStep(currentStep);
                }
            });
        
            function showStep(step) {
                tutorialSteps.forEach((stepEl, index) => {
                    stepEl.style.display = index === step ? 'block' : 'none';
                });
                prevStep.disabled = step === 0;
                nextStep.disabled = step === tutorialSteps.length - 1;
            }
        
            // Industry Prompts
            industryPrompts.forEach(prompt => {
                prompt.addEventListener('click', () => {
                    const prompts = prompt.parentElement.querySelector('.prompts');
                    prompts.style.display = prompts.style.display === 'block' ? 'none' : 'block';
                });
        
                const promptItems = prompt.parentElement.querySelectorAll('.prompt-item');
                promptItems.forEach(item => {
                    item.addEventListener('click', () => {
                        promptTextarea.value = item.textContent.trim();
                    });
                });
            });
        
            // Form Submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const prompt = promptTextarea.value.trim();
                if (!prompt) {
                    alert('Please enter a prompt to generate strategies.');
                    return;
                }
        
                fetch('{% url "generate_multiple_strategies" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: `prompt=${encodeURIComponent(prompt)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        strategiesContainer.innerHTML = '';
                        data.strategies.forEach(strategy => {
                            const card = document.createElement('div');
                            card.className = 'strategy-card';
                            card.setAttribute('data-id', strategy.id);
                            card.innerHTML = `
                                <h3>${strategy.title}</h3>
                                <div class="strategy-content" style="display: none;">
                                    ${strategy.content.map(item => `<p><strong>${item.key ? item.key + ':' : ''}</strong> ${item.value}</p>`).join('')}
                                </div>
                                <div class="strategy-actions">
                                    <button class="show-details">Show Details</button>
                                    <button class="edit-strategy">Edit</button>
                                    <button class="select-strategy" data-id="${strategy.id}">Select</button>
                                </div>
                            `;
        
                            const detailsBtn = card.querySelector('.show-details');
                            const contentDiv = card.querySelector('.strategy-content');
                            detailsBtn.addEventListener('click', () => {
                                const isHidden = contentDiv.style.display === 'none';
                                contentDiv.style.display = isHidden ? 'block' : 'none';
                                detailsBtn.textContent = isHidden ? 'Hide Details' : 'Show Details';
                            });
        
                            const editBtn = card.querySelector('.edit-strategy');
                            editBtn.addEventListener('click', () => {
                                const modal = document.getElementById('edit-modal');
                                const textarea = document.getElementById('edit-content');
                                textarea.value = strategy.content.map(item => `${item.key ? item.key + ':' : ''} ${item.value}`).join('\n');
                                modal.style.display = 'block';
                                modal.dataset.strategyId = strategy.id;
                            });
        
                            strategiesContainer.appendChild(card);
                        });
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while generating strategies.');
                });
            });
        
            // Edit Modal
            const editModal = document.getElementById('edit-modal');
            const editForm = document.getElementById('edit-form');
            const cancelEdit = document.getElementById('cancel-edit');
        
            editForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const strategyId = editModal.dataset.strategyId;
                const content = document.getElementById('edit-content').value;
                fetch('{% url "save_edited_strategy" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: `strategy_id=${strategyId}&content=${encodeURIComponent(content)}`
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        editModal.style.display = 'none';
                        form.dispatchEvent(new Event('submit')); // Refresh strategies
                    } else {
                        alert('Error: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while saving the strategy.');
                });
            });
        
            cancelEdit.addEventListener('click', () => {
                editModal.style.display = 'none';
            });
        });
        
        // Single clean version for select-strategy
        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('select-strategy')) {
                const strategyId = event.target.getAttribute('data-id');
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
                fetch("{% url 'select_strategy' %}", {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ strategy_id: strategyId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.redirect_url) {
                        window.location.href = data.redirect_url;
                    } else {
                        alert(data.error || 'Error: Unable to redirect to form.');
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    alert('Something went wrong.');
                });
            }
        });
        </script>
</body>
</html>